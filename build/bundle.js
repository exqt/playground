!function(){"use strict";class e{constructor(e,t,r){this.name=e,this.canvas=document.createElement("canvas"),this.canvas.width=400|t,this.canvas.height=400|r,this.canvas.id=e+"-canvas",this.canvas.addEventListener("click",this.onClick),document.querySelector("#canvas-wrapper").appendChild(this.canvas)}release(){let e=document.querySelector("#canvas-wrapper");for(;e.hasChildNodes();)e.removeChild(e.lastChild)}onDrop(e){}onClick(){}update(e){}}function t(e,t,o){const i=r(e,e.VERTEX_SHADER,t),n=r(e,e.FRAGMENT_SHADER,o),a=e.createProgram();return e.attachShader(a,i),e.attachShader(a,n),e.linkProgram(a),e.getProgramParameter(a,e.LINK_STATUS)?a:(alert("Unable to initialize the shader program: "+e.getProgramInfoLog(a)),null)}function r(e,t,r){const o=e.createShader(t);return e.shaderSource(o,r),e.compileShader(o),e.getShaderParameter(o,e.COMPILE_STATUS)?o:(alert("An error occurred compiling the shaders: "+e.getShaderInfoLog(o)),e.deleteShader(o),null)}function o(e){var t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),t}const i={colorTriangle:class extends e{constructor(){super("color-triangle",400,400),this.time=0;let e=this.canvas.getContext("webgl");this.program=t(e,"\nattribute vec2 aPosition;\nattribute vec4 aColor;\nuniform mat2 uMat;\nvarying vec4 vColor;\n\nvoid main() {\n  vColor = aColor;\n  gl_Position = vec4(uMat*aPosition, 1.0, 1.0);\n}\n","\nprecision mediump float;\n\nvarying vec4 vColor;\n\nvoid main() {\n  gl_FragColor = vColor;\n}\n"),e.useProgram(this.program),this.location={position:e.getAttribLocation(this.program,"aPosition"),color:e.getAttribLocation(this.program,"aColor"),mat:e.getUniformLocation(this.program,"uMat")},this.buffer={},this.buffer.position=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.buffer.position),e.bufferData(e.ARRAY_BUFFER,new Float32Array([Math.cos(.5*Math.PI),Math.sin(.5*Math.PI),Math.cos(7/12*2*Math.PI),Math.sin(7/12*2*Math.PI),Math.cos(11/12*2*Math.PI),Math.sin(11/12*2*Math.PI)]),e.STATIC_DRAW),this.buffer.color=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.buffer.color),e.bufferData(e.ARRAY_BUFFER,new Float32Array([1,0,0,1,0,1,0,1,0,0,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(this.location.position),e.bindBuffer(e.ARRAY_BUFFER,this.buffer.position),e.vertexAttribPointer(this.location.position,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.location.color),e.bindBuffer(e.ARRAY_BUFFER,this.buffer.color),e.vertexAttribPointer(this.location.color,4,e.FLOAT,!1,0,0)}update(e){this.time=this.time+e;let t=this.canvas.getContext("webgl");t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT),t.uniformMatrix2fv(this.location.mat,!1,new Float32Array([Math.cos(this.time),Math.sin(this.time),-Math.sin(this.time),Math.cos(this.time)])),t.drawArrays(t.TRIANGLES,0,3)}},pixelSort:class extends e{constructor(){super("pixel-sort",400,400),this.input=document.createElement("input"),this.input.type="file",this.input.addEventListener("change",e=>{let t=e.target.files[0];this.onDrop(t)}),document.querySelector("#canvas-wrapper").append(this.input);let e=this.canvas.getContext("webgl");this.program=t(e,"\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nuniform float uYflip;\n\nvoid main() {\n  vTexCoord = aTexCoord;\n  if(uYflip == 1.0) vTexCoord.y = 1.0 - vTexCoord.y;\n  gl_Position = vec4(aPosition, 1.0, 1.0);\n}\n","\nprecision mediump float;\n\nuniform sampler2D uImage;\nuniform vec2 uTextureSize;\nuniform float uStep;\nvarying vec2 vTexCoord;\n\nfloat brightness(vec4 c) {\n  return 0.2126*c.x + 0.7152*c.y + 0.0722*c.z;\n}\n\nfloat comp(vec4 a, vec4 b) {\n  return brightness(a) - brightness(b);\n}\n\nvoid main() {\n  vec2 onePixel = vec2(1.0, 1.0) / uTextureSize;\n  vec4 color = vec4(0.0);\n  \n  float parity = fract(uStep/2.0 + vTexCoord.y*uTextureSize.y/2.0);\n\n  if (parity < 0.5) {\n    vec4 c1 = texture2D(uImage, vTexCoord);\n    vec4 c2 = texture2D(uImage, vTexCoord + vec2(0, onePixel.y));\n\n    if (vTexCoord.y + onePixel.y >= 1.0) color = c1;\n    else color = comp(c1, c2) >= 0.0 ? c1 : c2;\n  }\n  else {\n    vec4 c1 = texture2D(uImage, vTexCoord - vec2(0, onePixel.y));\n    vec4 c2 = texture2D(uImage, vTexCoord);\n\n    if (vTexCoord.y - onePixel.y <= 0.0) color = c2;\n    else color = comp(c2, c1) < 0.0 ? c2 : c1;\n  }\n  \n  gl_FragColor = color;\n}\n"),e.useProgram(this.program),this.location={position:e.getAttribLocation(this.program,"aPosition"),texCoord:e.getAttribLocation(this.program,"aTexCoord"),textureSize:e.getUniformLocation(this.program,"uTextureSize"),step:e.getUniformLocation(this.program,"uStep"),yflip:e.getUniformLocation(this.program,"uYflip")},this.buffer={},this.buffer.position=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.buffer.position),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,1,-1,-1,1,-1,1,1,-1,1,1]),e.STATIC_DRAW),this.buffer.texCoord=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.buffer.texCoord),e.bufferData(e.ARRAY_BUFFER,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1]),e.STATIC_DRAW),e.enableVertexAttribArray(this.location.position),e.bindBuffer(e.ARRAY_BUFFER,this.buffer.position),e.vertexAttribPointer(this.location.position,2,e.FLOAT,!1,0,0),e.enableVertexAttribArray(this.location.texCoord),e.bindBuffer(e.ARRAY_BUFFER,this.buffer.texCoord),e.vertexAttribPointer(this.location.texCoord,2,e.FLOAT,!1,0,0)}onDrop(e){let t=new FileReader;t.onload=e=>{let t=new Image;t.src=e.target.result,t.onload=()=>{this.setImage(t)}},t.readAsDataURL(e)}setImage(e){let t=this.canvas.getContext("webgl");this.canvas.width=e.width,this.canvas.height=e.height,this.originalImageTexture=o(t),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e),this.textures=[],this.framebuffers=[];for(let r=0;r<2;++r){let r=o(t);this.textures.push(r),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.width,e.height,0,t.RGBA,t.UNSIGNED_BYTE,null);let i=t.createFramebuffer();this.framebuffers.push(i),t.bindFramebuffer(t.FRAMEBUFFER,i),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,r,0)}t.viewport(0,0,this.canvas.width,this.canvas.height),this.step=0,t.uniform2f(this.location.textureSize,e.width,e.height),t.bindTexture(t.TEXTURE_2D,this.originalImageTexture)}update(e){if(!this.originalImageTexture)return;let t=this.canvas.getContext("webgl"),r=e=>{e|=0,t.clearColor(0,1,0,1),t.clear(t.COLOR_BUFFER_BIT),t.uniform1f(this.location.step,this.step),t.uniform1f(this.location.yflip,e),t.drawArrays(t.TRIANGLES,0,6)};t.bindFramebuffer(t.FRAMEBUFFER,this.framebuffers[this.step%2]),r(),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindTexture(t.TEXTURE_2D,this.textures[this.step%2]),r(1),this.step++}}};let n,a=null,s=document.querySelector("#scene-select");function c(e){return!!i[e]&&(s.value=e,a&&a.release(),a=new i[e],!0)}s.onchange=e=>{c(s.value)},document.ondragover=e=>{e.stopPropagation(),e.preventDefault()},document.ondrop=e=>{if(e.stopPropagation(),e.preventDefault(),a){let t=e.dataTransfer.files[0];t&&a.onDrop(t)}};for(let[e,t]of Object.entries(i)){let t=document.createElement("option");t.value=e,t.text=e,s.append(t)}c(new URLSearchParams(window.location.search).get("scene"))||c("colorTriangle");const l=e=>{void 0===n&&(n=e);const t=(e-n)/1e3;a&&a.update(t),n=e,window.requestAnimationFrame(l)};window.requestAnimationFrame(l)}();
//# sourceMappingURL=bundle.js.map
